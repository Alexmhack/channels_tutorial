{% extends "base.html" %}

{% block title %}
	Django Room
{% endblock %}

{% block content %}
	
	<div class="container">
		
		<!-- textarea -->
		<div class="form-group shadow-textarea">
		    <label for="exampleFormControlTextarea6">Previous messages</label>
		    <textarea class="form-control z-depth-1" id="chat-log" rows=5" placeholder="Write message here..."></textarea>
		</div>

		<!-- input field -->
		<!-- Large input -->
		<input id="chat-message-input" class="form-control form-control-lg" type="text" placeholder="Large input
		">

		<!-- send button -->
		<button id="chat-message-submit" type="submit" class="btn btn-primary btn-md">Send</button>

	</div>

{% endblock content %}

{% block script %}
	
	<script type="text/javascript" charset="utf-8" async defer>
		
		var roomName = {{ room_name_json }};

		var chatSocket = new Websocket(
			'ws://' + window.location.host + 'ws/chat/' + roomName + '/'
		);

		chatSocket.onmessage = function(e) {
			var data = 	JSON.parse(e.data);
			var message = data['message'];
			$("#chat-log").val() += (message  +'\n');
		};

		chatSocket.onclose = function(e) {
			console.log("chat socket closed unexpectedly");
		};

		$("#chat-message-input").focus();

		$("#chat-message-input").keyup(function(e) {
			if (e.keyCode === 13) {
				$("#chat-message-submit").click();
			}
		});

		$("#chat-message-submit").click(function(e) {
			var $messageInput = $("#chat-message-input");
			var message = $messageInput.val();

			chatSocket.send(JSON.stringify({
	            'message': message
	        }));

	        $messageInput.val('');
		});

	</script>

{% endblock %}
